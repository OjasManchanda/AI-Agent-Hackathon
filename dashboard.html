<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Influencer Intelligence Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.18.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(255,255,255,0.6)); }
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .dashboard-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            margin: 5px;
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab-button.active,
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 15px 20px;
            border: 3px solid #e1e5e9;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .channel-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .channel-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .channel-card.selected {
            border-color: #4ECDC4;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
        }

        .category-header {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            color: #667eea;
        }

        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(15px);
            margin-bottom: 30px;
        }

        .ai-insights-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .insight-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metric-label {
            color: #666;
            margin-top: 5px;
            font-size: 14px;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px 5px 0 0;
        }

        .trend-rising { background: #4CAF50; color: white; }
        .trend-stable { background: #FF9800; color: white; }
        .trend-declining { background: #F44336; color: white; }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .creator-comparison-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .creator-comparison-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .report-actions {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .action-btn.secondary {
            background: linear-gradient(45deg, #FF6B6B, #FF5722);
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 18px;
            display: none;
        }

        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-banner {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #2E7D32;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            display: none;
        }

        .highlight-box {
            background: linear-gradient(135deg, #FFE082, #FFC107);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
        }

        .recommendation-box {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 10px 10px 0;
        }

        .creator-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .creator-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .creator-info h3 {
            margin: 0;
            font-size: 18px;
        }

        .creator-info p {
            margin: 5px 0;
            opacity: 0.8;
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .tag {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Demo Mode Styling */
        .demo-banner {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.5em; }
            .search-box { flex-direction: column; }
            .search-input { min-width: 100%; }
            .dashboard-tabs { justify-content: flex-start; }
            .metric-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
            .comparison-grid { grid-template-columns: 1fr; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI-Powered Influencer Intelligence</h1>
            <p>Advanced Creator Analytics & Brand Partnership Intelligence</p>
            <div class="ai-badge">✨ Powered by Advanced AI & Machine Learning</div>
        </div>

        <!-- Demo Mode Banner -->
        <div class="demo-banner">
            🚀 DEMO MODE: Experience advanced AI analytics with sample data. Connect your backend for live YouTube data!
        </div>

        <!-- System Status -->
        <div id="systemStatus" class="status-banner">
            <span id="statusIcon">🟢</span>
            <span id="statusText">System operational - Real-time monitoring active</span>
        </div>

        <!-- Navigation Tabs -->
        <div class="dashboard-tabs">
            <button class="tab-button active" onclick="switchTab('search')">🔍 Creator Search</button>
            <button class="tab-button" onclick="switchTab('monitor')">📊 Channel Monitor</button>
            <button class="tab-button" onclick="switchTab('compare')">⚖️ Compare Creators</button>
            <button class="tab-button" onclick="switchTab('trends')">📈 Trending Insights</button>
            <button class="tab-button" onclick="switchTab('reports')">📋 Executive Reports</button>
        </div>

        <!-- Search Tab -->
        <div id="searchTab" class="tab-content active">
            <div class="search-section">
                <h2>🎯 Individual Creator Analysis</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="Enter YouTuber name (e.g., MrBeast, MKBHD, PewDiePie)" />
                    <button id="searchBtn" class="search-btn">🚀 Analyze with AI</button>
                </div>
                <div class="tags-container">
                    <div class="tag" onclick="searchDemo('MrBeast')">Try: MrBeast</div>
                    <div class="tag" onclick="searchDemo('MKBHD')">Try: MKBHD</div>
                    <div class="tag" onclick="searchDemo('PewDiePie')">Try: PewDiePie</div>
                    <div class="tag" onclick="searchDemo('Kurzgesagt')">Try: Kurzgesagt</div>
                </div>
            </div>
        </div>

        <!-- Monitor Tab -->
        <div id="monitorTab" class="tab-content">
            <div class="search-section">
                <h2>📡 Multi-Channel Monitoring Dashboard</h2>
                <p>Select channels from our curated list of top creators across different niches</p>
                
                <div class="report-actions">
                    <button class="action-btn" onclick="selectAllChannels()">✅ Select All</button>
                    <button class="action-btn secondary" onclick="clearSelection()">❌ Clear Selection</button>
                    <button class="action-btn" onclick="analyzeSelectedChannels()">🔬 Analyze Selected</button>
                </div>

                <div id="channelSelection">
                    <!-- Channels will be populated here -->
                </div>
            </div>
        </div>

        <!-- Compare Tab -->
        <div id="compareTab" class="tab-content">
            <div class="search-section">
                <h2>⚖️ Creator Comparison & Benchmarking</h2>
                <p>Compare multiple creators side-by-side with AI-powered insights</p>
                
                <div class="search-box">
                    <input type="text" id="compareInput" class="search-input" 
                           placeholder="Enter creator names separated by commas (e.g., MrBeast, PewDiePie, MKBHD)" />
                    <button id="compareBtn" class="search-btn">🔍 Compare Creators</button>
                </div>
                <div class="tags-container">
                    <div class="tag" onclick="compareDemo()">Try: MrBeast vs PewDiePie vs MKBHD</div>
                </div>
            </div>
        </div>

        <!-- Trends Tab -->
        <div id="trendsTab" class="tab-content">
            <div class="search-section">
                <h2>📈 Real-Time Trending Insights</h2>
                <div class="report-actions">
                    <button class="action-btn" onclick="refreshTrendingData()">🔄 Refresh Data</button>
                    <button class="action-btn secondary" onclick="generateTrendReport()">📊 Generate Report</button>
                </div>
                
                <div id="trendingInsights">
                    <!-- Trending data will be populated here -->
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div class="search-section">
                <h2>📋 Executive Reports & Analytics</h2>
                
                <div class="report-actions">
                    <button class="action-btn" onclick="generateExecutiveReport('standard')">📊 Standard Report</button>
                    <button class="action-btn" onclick="generateExecutiveReport('detailed')">📈 Detailed Analytics</button>
                    <button class="action-btn secondary" onclick="generateExecutiveReport('competitive')">🎯 Competitive Analysis</button>
                </div>
                
                <div id="reportResults">
                    <!-- Reports will be populated here -->
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loadingText">🤖 AI is analyzing creator data... This may take a moment.</p>
        </div>

        <!-- Error Display -->
        <div id="error" class="error"></div>

        <!-- Results Section -->
        <div id="results" class="results-section" style="display: none;">
            <!-- AI Insights Panel -->
            <div class="ai-insights-panel">
                <div class="insight-title">
                    🧠 AI-Powered Creator Intelligence
                </div>
                <div id="aiInsights">
                    <!-- AI insights will be populated here -->
                </div>
            </div>

            <!-- Performance Metrics -->
            <div id="performanceMetrics">
                <!-- Metrics will be populated here -->
            </div>

            <!-- Charts Section -->
            <div id="chartsSection">
                <!-- Charts will be populated here -->
            </div>

            <!-- Detailed Results -->
            <div id="detailedResults">
                <!-- Detailed analysis will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedChannels = new Set();
        let currentAnalysisData = null;
        let monitoredChannels = {};
        let demoMode = true; // Enable demo mode by default
        
        // API configuration
        const API_BASE = window.location.origin;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadMonitoredChannels();
            initializeEventListeners();
        });

        function initializeEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', performSingleSearch);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSingleSearch();
            });
            
            document.getElementById('compareBtn').addEventListener('click', performComparison);
            document.getElementById('compareInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performComparison();
            });
        }

        // Tab switching with smooth animations
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab with animation
            const selectedTab = document.getElementById(tabName + 'Tab');
            selectedTab.classList.add('active');
            event.target.classList.add('active');

            // Load tab-specific data
            if (tabName === 'trends') {
                loadTrendingInsights();
            } else if (tabName === 'monitor') {
                loadMonitoredChannels();
            }
        }

        // System status with fallback
        async function loadSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/status`);
                const status = await response.json();
                
                const statusElement = document.getElementById('systemStatus');
                const statusIcon = document.getElementById('statusIcon');
                const statusText = document.getElementById('statusText');
                
                if (status.system_status === 'operational') {
                    statusIcon.textContent = '🟢';
                    statusText.textContent = `System operational - ${status.cached_profiles} creators cached`;
                    statusElement.style.display = 'flex';
                    demoMode = false;
                } else {
                    showDemoStatus();
                }
            } catch (error) {
                showDemoStatus();
            }
        }

        function showDemoStatus() {
            const statusElement = document.getElementById('systemStatus');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            
            statusIcon.textContent = '🔄';
            statusText.textContent = 'Demo mode active - Connect backend for live data';
            statusElement.style.display = 'flex';
            statusElement.style.background = 'rgba(255, 193, 7, 0.1)';
            statusElement.style.borderColor = '#FFC107';
            statusElement.style.color = '#856404';
        }

        // Enhanced monitored channels with demo data
        async function loadMonitoredChannels() {
            try {
                if (demoMode) {
                    monitoredChannels = getDemoChannels();
                    displayChannelSelection();
                    return;
                }
                
                const response = await fetch(`${API_BASE}/api/channels`);
                monitoredChannels = await response.json();
                displayChannelSelection();
            } catch (error) {
                console.error('Failed to load channels:', error);
                monitoredChannels = getDemoChannels();
                displayChannelSelection();
            }
        }

        function getDemoChannels() {
            return {
                "Tech": [
                    {"name": "MKBHD", "handle": "mkbhd", "subscribers": "18.2M"},
                    {"name": "Unbox Therapy", "handle": "unboxtherapy", "subscribers": "18.1M"},
                    {"name": "Linus Tech Tips", "handle": "linustechtips", "subscribers": "15.4M"},
                    {"name": "Dave2D", "handle": "dave2d", "subscribers": "3.2M"}
                ],
                "Gaming": [
                    {"name": "PewDiePie", "handle": "pewdiepie", "subscribers": "111M"},
                    {"name": "MrBeast Gaming", "handle": "mrbeastgaming", "subscribers": "30.5M"},
                    {"name": "Jacksepticeye", "handle": "jacksepticeye", "subscribers": "29.1M"},
                    {"name": "Markiplier", "handle": "markiplier", "subscribers": "35.7M"}
                ],
                "Entertainment": [
                    {"name": "MrBeast", "handle": "mrbeast", "subscribers": "212M"},
                    {"name": "Dude Perfect", "handle": "dudeperfect", "subscribers": "59.1M"},
                    {"name": "James Charles", "handle": "jamescharles", "subscribers": "23.8M"},
                    {"name": "Emma Chamberlain", "handle": "emmachamberlain", "subscribers": "11.9M"}
                ],
                "Education": [
                    {"name": "Veritasium", "handle": "veritasium", "subscribers": "13.9M"},
                    {"name": "Kurzgesagt", "handle": "kurzgesagt", "subscribers": "20.1M"},
                    {"name": "Khan Academy", "handle": "khanacademy", "subscribers": "7.5M"},
                    {"name": "Crash Course", "handle": "crashcourse", "subscribers": "14.7M"}
                ]
            };
        }

        function displayChannelSelection() {
            const container = document.getElementById('channelSelection');
            if (!container || !monitoredChannels) return;
            
            let html = '';
            
            for (const [category, channels] of Object.entries(monitoredChannels)) {
                html += `<div class="category-header">${category} Creators</div>`;
                html += '<div class="channel-grid">';
                
                channels.forEach(channel => {
                    html += `
                        <div class="channel-card" onclick="toggleChannelSelection('${channel.name}', '${category}')">
                            <div style="font-weight: bold; margin-bottom: 5px;">${channel.name}</div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">${category}</div>
                            ${channel.subscribers ? `<div style="font-size: 11px; color: #4ECDC4; font-weight: bold;">${channel.subscribers} subscribers</div>` : ''}
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function toggleChannelSelection(channelName, category) {
            const channelCards = document.querySelectorAll('.channel-card');
            const targetCard = Array.from(channelCards).find(card => 
                card.textContent.includes(channelName)
            );
            
            if (selectedChannels.has(channelName)) {
                selectedChannels.delete(channelName);
                targetCard.classList.remove('selected');
            } else {
                selectedChannels.add(channelName);
                targetCard.classList.add('selected');
            }
        }

        function selectAllChannels() {
            selectedChannels.clear();
            document.querySelectorAll('.channel-card').forEach(card => {
                const channelName = card.textContent.split('\n')[0].trim();
                selectedChannels.add(channelName);
                card.classList.add('selected');
            });
        }

        function clearSelection() {
            selectedChannels.clear();
            document.querySelectorAll('.channel-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // Demo search functions
        function searchDemo(creatorName) {
            document.getElementById('searchInput').value = creatorName;
            performSingleSearch();
        }

        function compareDemo() {
            document.getElementById('compareInput').value = 'MrBeast, PewDiePie, MKBHD';
            performComparison();
        }

        // Enhanced search functions with demo data
        async function performSingleSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showError('Please enter a creator name to analyze.');
                return;
            }

            showLoading('Analyzing creator with AI...');
            hideError();
            hideResults();

            try {
                let data;
                if (demoMode) {
                    data = generateDemoCreatorData(query);
                } else {
                    const response = await fetch(`${API_BASE}/api/search`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: query, max_results: 10 })
                    });
                    data = await response.json();
                    
                    if (!response.ok) {
                        showError(data.error || 'An error occurred during analysis.');
                        return;
                    }
                }

                hideLoading();
                currentAnalysisData = data;
                displaySingleCreatorResults(data);

            } catch (err) {
                hideLoading();
                if (demoMode) {
                    const data = generateDemoCreatorData(query);
                    currentAnalysisData = data;
                    displaySingleCreatorResults(data);
                } else {
                    showError('Failed to connect to the AI analysis server. Please check your connection.');
                    console.error('Search error:', err);
                }
            }
        }

        async function performComparison() {
            const input = document.getElementById('compareInput').value.trim();
            if (!input) {
                showError('Please enter creator names to compare.');
                return;
            }

            const channels = input.split(',').map(c => c.trim()).filter(c => c.length > 0);
            if (channels.length < 2) {
                showError('Please enter at least 2 creator names separated by commas.');
                return;
            }

            if (channels.length > 5) {
                showError('Maximum 5 creators can be compared at once.');
                return;
            }

            showLoading('Comparing creators with AI analysis...');
            hideError();
            hideResults();

            try {
                let data;
                if (demoMode) {
                    data = generateDemoComparisonData(channels);
                } else {
                    const response = await fetch(`${API_BASE}/api/compare`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ channels: channels })
                    });
                    data = await response.json();
                    
                    if (!response.ok) {
                        showError(data.error || 'Comparison failed.');
                        return;
                    }
                }

                hideLoading();
                displayComparisonResults(data);

            } catch (err) {
                hideLoading();
                if (demoMode) {
                    const data = generateDemoComparisonData(channels);
                    displayComparisonResults(data);
                } else {
                    showError('Failed to perform comparison. Please check your connection.');
                    console.error('Comparison error:', err);
                }
            }
        }

        async function analyzeSelectedChannels() {
            if (selectedChannels.size === 0) {
                showError('Please select at least one channel to analyze.');
                return;
            }

            showLoading(`Analyzing ${selectedChannels.size} selected creators...`);
            hideError();
            hideResults();

            try {
                const channelArray = Array.from(selectedChannels);
                let data;
                
                if (demoMode) {
                    data = generateDemoComparisonData(channelArray);
                } else {
                    const response = await fetch(`${API_BASE}/api/compare`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ channels: channelArray })
                    });
                    data = await response.json();
                    
                    if (!response.ok) {
                        showError(data.error || 'Analysis failed.');
                        return;
                    }
                }

                hideLoading();
                displayMultiChannelResults(data);

            } catch (err) {
                hideLoading();
                if (demoMode) {
                    const data = generateDemoComparisonData(Array.from(selectedChannels));
                    displayMultiChannelResults(data);
                } else {
                    showError('Failed to analyze selected channels.');
                    console.error('Multi-channel analysis error:', err);
                }
            }
        }

        // Demo data generators
        function generateDemoCreatorData(creatorName) {
            const demoProfiles = {
                'MrBeast': {
                    channel_info: {
                        id: 'UCX6OQ3DkcsbYNE6H8uQQuVA',
                        title: 'MrBeast',
                        subscriber_count: 212000000,
                        video_count: 741,
                        view_count: 45000000000,
                        thumbnail: 'https://yt3.googleusercontent.com/ytc/AGIKgqNRr7IEdQ7TplsO8BG-KjG19aCcCpVjiV9l36-9lQ=s176-c-k-c0x00ffffff-no-rj'
                    },
                    ai_analysis: {
                        content_dna: {
                            primary_themes: {
                                'challenge': 45,
                                'money': 38,
                                'philanthropy': 32,
                                'gaming': 25,
                                'giveaway': 28
                            },
                            sentiment_profile: {
                                vader_avg: 0.7,
                                dominant_sentiment: 'positive'
                            }
                        },
                        performance_metrics: {
                            avg_views: 89500000,
                            avg_engagement_rate: 6.8,
                            consistency_score: 9.2,
                            trend_direction: 'rising'
                        },
                        posting_behavior: {
                            frequency: 'weekly'
                        },
                        brand_compatibility: {
                            safety_score: 9.1
                        },
                        recommendations: [
                            'Excellent partnership potential with massive reach',
                            'Strong positive sentiment and brand safety',
                            'High engagement rates across all content types'
                        ]
                    }
                },
                'MKBHD': {
                    channel_info: {
                        id: 'UCBJycsmduvYEL83R_U4JriQ',
                        title: 'Marques Brownlee',
                        subscriber_count: 18200000,
                        video_count: 1547,
                        view_count: 3800000000,
                        thumbnail: 'https://yt3.googleusercontent.com/ytc/AGIKgqP2yKVLdIh9CJ7B0mzOlVDWwgUdmWjE_nCJ0w=s176-c-k-c0x00ffffff-no-rj'
                    },
                    ai_analysis: {
                        content_dna: {
                            primary_themes: {
                                'tech': 72,
                                'review': 68,
                                'smartphone': 45,
                                'apple': 38,
                                'android': 35
                            },
                            sentiment_profile: {
                                vader_avg: 0.4,
                                dominant_sentiment: 'neutral'
                            }
                        },
                        performance_metrics: {
                            avg_views: 2500000,
                            avg_engagement_rate: 4.2,
                            consistency_score: 8.7,
                            trend_direction: 'stable'
                        },
                        posting_behavior: {
                            frequency: 'multiple_per_week'
                        },
                        brand_compatibility: {
                            safety_score: 9.8
                        },
                        recommendations: [
                            'Ideal for tech product partnerships',
                            'High credibility in tech community',
                            'Excellent brand safety scores'
                        ]
                    }
                },
                'PewDiePie': {
                    channel_info: {
                        id: 'UC-lHJZR3Gqxm24_Vd_AJ5Yw',
                        title: 'PewDiePie',
                        subscriber_count: 111000000,
                        video_count: 4700,
                        view_count: 29000000000,
                        thumbnail: 'https://yt3.googleusercontent.com/5oUY3tashyxfqsjO5SGhjMYzI2t7bE-2gfF6i89tJXt7KG9_1gfKVwdKxBGlKKgF=s176-c-k-c0x00ffffff-no-rj'
                    },
                    ai_analysis: {
                        content_dna: {
                            primary_themes: {
                                'gaming': 48,
                                'reaction': 35,
                                'memes': 42,
                                'commentary': 38,
                                'minecraft': 25
                            },
                            sentiment_profile: {
                                vader_avg: 0.3,
                                dominant_sentiment: 'positive'
                            }
                        },
                        performance_metrics: {
                            avg_views: 3200000,
                            avg_engagement_rate: 5.4,
                            consistency_score: 7.8,
                            trend_direction: 'stable'
                        },
                        posting_behavior: {
                            frequency: 'daily'
                        },
                        brand_compatibility: {
                            safety_score: 7.2
                        },
                        recommendations: [
                            'Strong gaming and entertainment partnerships',
                            'Massive engaged community',
                            'Consider content alignment carefully'
                        ]
                    }
                }
            };

            // Return specific profile or generate generic one
            if (demoProfiles[creatorName]) {
                const profile = demoProfiles[creatorName];
                profile.videos = generateDemoVideos(creatorName);
                return profile;
            }

            // Generic demo profile
            return {
                channel_info: {
                    id: 'demo_' + Math.random().toString(36).substr(2, 9),
                    title: creatorName,
                    subscriber_count: Math.floor(Math.random() * 10000000) + 100000,
                    video_count: Math.floor(Math.random() * 1000) + 50,
                    view_count: Math.floor(Math.random() * 1000000000) + 10000000,
                    thumbnail: 'https://via.placeholder.com/176x176/667eea/ffffff?text=' + creatorName.charAt(0)
                },
                ai_analysis: {
                    content_dna: {
                        primary_themes: {
                            'general': 30,
                            'entertainment': 25,
                            'lifestyle': 20
                        },
                        sentiment_profile: {
                            vader_avg: Math.random() * 0.6 + 0.2,
                            dominant_sentiment: 'positive'
                        }
                    },
                    performance_metrics: {
                        avg_views: Math.floor(Math.random() * 1000000) + 50000,
                        avg_engagement_rate: Math.random() * 8 + 2,
                        consistency_score: Math.random() * 3 + 7,
                        trend_direction: ['rising', 'stable', 'declining'][Math.floor(Math.random() * 3)]
                    },
                    posting_behavior: {
                        frequency: 'weekly'
                    },
                    brand_compatibility: {
                        safety_score: Math.random() * 3 + 7
                    },
                    recommendations: [
                        'Standard partnership potential',
                        'Monitor performance trends',
                        'Review content alignment'
                    ]
                },
                videos: generateDemoVideos(creatorName)
            };
        }

        function generateDemoVideos(creatorName) {
            const videoTitles = {
                'MrBeast': [
                    'I Gave Away $1,000,000 To Random People',
                    'Last To Leave Circle Wins $500,000',
                    'I Built The World\'s Largest Lego Tower',
                    'Giving Away Private Island',
                    '1000 People Build A City',
                    'World\'s Most Expensive Food Taste Test'
                ],
                'MKBHD': [
                    'iPhone 15 Pro Review: The Best iPhone Yet?',
                    'Tesla Model S Plaid: 1000HP Electric Beast!',
                    'Galaxy S24 Ultra vs iPhone 15 Pro Max',
                    'Vision Pro Review: The Future is Here',
                    'Best Smartphones of 2024',
                    'MacBook Pro M3 Review'
                ],
                'PewDiePie': [
                    'This Game Made Me Cry...',
                    'Reddit Review: Cursed Images',
                    'Minecraft But Everything is WRONG',
                    'Reacting to My Old Cringe Videos',
                    'Playing Horror Games at 3AM',
                    'Building the Ultimate Base'
                ]
            };

            const titles = videoTitles[creatorName] || [
                'Amazing Content You Need to See',
                'This Changed Everything',
                'You Won\'t Believe What Happened',
                'Epic Challenge Video',
                'Life-Changing Experience',
                'Must-Watch Content'
            ];

            return titles.map((title, index) => ({
                id: 'demo_video_' + index,
                title: title,
                description: `${title} - An amazing video by ${creatorName} showcasing incredible content...`,
                thumbnail: `https://via.placeholder.com/320x180/667eea/ffffff?text=Video${index + 1}`,
                published_at: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                views: Math.floor(Math.random() * 10000000) + 100000,
                likes: Math.floor(Math.random() * 500000) + 5000,
                comments: Math.floor(Math.random() * 50000) + 500,
                engagement_rate: Math.random() * 8 + 2,
                days_since_publish: Math.floor(Math.random() * 30),
                duration: Math.floor(Math.random() * 20) + 5 + ':' + String(Math.floor(Math.random() * 60)).padStart(2, '0'),
                url: `https://youtube.com/watch?v=demo_${index}`,
                analysis: {
                    viral_score: Math.floor(Math.random() * 5) + 5,
                    content_category: ['Tech', 'Entertainment', 'Gaming', 'Education'][Math.floor(Math.random() * 4)],
                    brand_safety_score: Math.random() * 3 + 7,
                    engagement_quality: ['excellent', 'high', 'medium'][Math.floor(Math.random() * 3)],
                    recommended_action: 'Strong partnership potential - high engagement and positive sentiment',
                    ai_insights: {
                        sentiment_score: Math.random() * 0.6 + 0.2,
                        key_themes: ['trending', 'viral', 'engaging'],
                        content_tone: 'positive'
                    }
                }
            }));
        }

        function generateDemoComparisonData(channels) {
            const individual_results = {};
            
            channels.forEach(channel => {
                individual_results[channel] = generateDemoCreatorData(channel);
            });

            const comparison_report = {
                report_generated_at: new Date().toISOString(),
                analyzed_channels_count: channels.length,
                trending_topics_across_creators: {
                    'AI': 8,
                    'Gaming': 6,
                    'Tech': 5,
                    'Review': 4,
                    'Challenge': 7
                },
                performance_benchmarks: {
                    avg_engagement_rate: 5.2,
                    high_performers: channels.slice(0, Math.ceil(channels.length / 2)),
                    rising_creators: channels.slice(-Math.ceil(channels.length / 3))
                },
                brand_safety_overview: {
                    safe_creators: channels.filter(() => Math.random() > 0.3),
                    moderate_risk: channels.filter(() => Math.random() > 0.8),
                    high_risk: []
                },
                actionable_insights: [
                    `Analyzed ${channels.length} creators across multiple niches`,
                    'Strong overall engagement rates detected',
                    'High brand safety scores across selection',
                    'Recommend focusing on top performers for partnerships'
                ]
            };

            return {
                individual_results,
                comparison_report
            };
        }

        // Results display functions
        function displaySingleCreatorResults(data) {
            const { channel_info, videos, ai_analysis } = data;

            displayAIInsights(ai_analysis, channel_info);
            displayPerformanceMetrics(channel_info, ai_analysis);
            displayCharts(videos, ai_analysis);
            displayVideoResults(videos);

            showResults();
        }

        function displayAIInsights(aiAnalysis, channelInfo) {
            const container = document.getElementById('aiInsights');
            
            const insights = `
                <div class="creator-profile">
                    <img src="${channelInfo?.thumbnail || 'https://via.placeholder.com/60x60'}" alt="${channelInfo?.title}" class="creator-avatar">
                    <div class="creator-info">
                        <h3>${channelInfo?.title || 'Unknown Creator'}</h3>
                        <p>${formatNumber(channelInfo?.subscriber_count || 0)} subscribers • ${formatNumber(channelInfo?.view_count || 0)} total views</p>
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">🎯 Content DNA Analysis</div>
                    <div class="highlight-box">
                        Primary Content Themes: ${Object.keys(aiAnalysis.content_dna.primary_themes || {}).slice(0, 3).join(', ') || 'General Content'}
                    </div>
                    <p><strong>Consistency Score:</strong> ${aiAnalysis.performance_metrics.consistency_score || 0}/10</p>
                    <p><strong>Sentiment Profile:</strong> ${(aiAnalysis.content_dna.sentiment_profile.dominant_sentiment || 'neutral').toUpperCase()} 
                    (${((aiAnalysis.content_dna.sentiment_profile.vader_avg || 0) * 100).toFixed(1)}% positive sentiment)</p>
                </div>

                <div class="insight-card">
                    <div class="insight-title">📊 Performance Intelligence</div>
                    <div class="trend-indicator trend-${aiAnalysis.performance_metrics.trend_direction || 'stable'}">
                        ${aiAnalysis.performance_metrics.trend_direction === 'rising' ? '📈' : 
                          aiAnalysis.performance_metrics.trend_direction === 'declining' ? '📉' : '📊'} 
                        ${(aiAnalysis.performance_metrics.trend_direction || 'stable').toUpperCase()}
                    </div>
                    <p><strong>Average Engagement:</strong> ${aiAnalysis.performance_metrics.avg_engagement_rate || 0}%</p>
                    <p><strong>Posting Frequency:</strong> ${(aiAnalysis.posting_behavior?.frequency || 'unknown').replace('_', ' ')}</p>
                </div>

                <div class="insight-card">
                    <div class="insight-title">🛡️ Brand Compatibility</div>
                    <div class="metric-value" style="font-size: 24px;">${aiAnalysis.brand_compatibility.safety_score || 0}/10</div>
                    <div class="recommendation-box">
                        ${(aiAnalysis.recommendations || ['No recommendations available']).join('<br>')}
                    </div>
                </div>
            `;
            
            container.innerHTML = insights;
        }

        function displayPerformanceMetrics(channelInfo, aiAnalysis) {
            const container = document.getElementById('performanceMetrics');
            
            const metrics = `
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-value">${formatNumber(channelInfo.subscriber_count || 0)}</div>
                        <div class="metric-label">Subscribers</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${formatNumber(aiAnalysis.performance_metrics.avg_views || 0)}</div>
                        <div class="metric-label">Avg Views per Video</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${aiAnalysis.performance_metrics.avg_engagement_rate || 0}%</div>
                        <div class="metric-label">Avg Engagement Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${aiAnalysis.performance_metrics.consistency_score || 0}/10</div>
                        <div class="metric-label">Consistency Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${(aiAnalysis.posting_behavior?.frequency || 'unknown').replace('_', ' ')}</div>
                        <div class="metric-label">Posting Frequency</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${aiAnalysis.brand_compatibility.safety_score || 0}/10</div>
                        <div class="metric-label">Brand Safety Score</div>
                    </div>
                </div>
            `;
            
            container.innerHTML = metrics;
        }

        function displayCharts(videos, aiAnalysis) {
            const container = document.getElementById('chartsSection');
            
            container.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">📈 Performance Trends</div>
                    <canvas id="performanceChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">🎯 Content Theme Distribution</div>
                    <canvas id="themeChart" width="400" height="200"></canvas>
                </div>
            `;

            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: videos.slice(0, 10).map((v, i) => `Video ${i + 1}`),
                    datasets: [{
                        label: 'Engagement Rate %',
                        data: videos.slice(0, 10).map(v => v.engagement_rate || 0),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Views (scaled)',
                        data: videos.slice(0, 10).map(v => (v.views || 0) / 10000),
                        borderColor: '#4ECDC4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Theme Chart
            const themes = aiAnalysis.content_dna.primary_themes || {};
            const themeCtx = document.getElementById('themeChart').getContext('2d');
            new Chart(themeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(themes).slice(0, 6),
                    datasets: [{
                        data: Object.values(themes).slice(0, 6),
                        backgroundColor: [
                            '#667eea', '#4ECDC4', '#45B7D1', '#F39C12',
                            '#E74C3C', '#9B59B6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
        }

        function displayVideoResults(videos) {
            const container = document.getElementById('detailedResults');
            
            let html = '<div style="padding: 20px;"><h3>🎥 Recent Video Analysis</h3>';
            html += '<div class="comparison-grid">';
            
            videos.slice(0, 6).forEach(video => {
                html += `
                    <div class="creator-comparison-card">
                        <img src="${video.thumbnail || 'https://via.placeholder.com/320x180'}" alt="${video.title || 'Video'}" class="video-thumbnail">
                        <div style="font-weight: bold; font-size: 14px; margin-bottom: 10px; line-height: 1.3;">${video.title || 'Untitled Video'}</div>
                        
                        <div class="metric-grid" style="grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                            <div>👁️ ${formatNumber(video.views || 0)}</div>
                            <div>👍 ${formatNumber(video.likes || 0)}</div>
                            <div>💬 ${formatNumber(video.comments || 0)}</div>
                            <div>📊 ${video.engagement_rate || 0}%</div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <div class="trend-indicator trend-${(video.analysis?.engagement_quality || 'medium') === 'excellent' ? 'rising' : (video.analysis?.engagement_quality || 'medium') === 'high' ? 'stable' : 'declining'}">
                                ${video.engagement_rate || 0}% Engagement
                            </div>
                        </div>
                        
                        <div class="highlight-box" style="font-size: 11px; margin: 10px 0;">
                            🔥 Viral Score: ${(video.analysis?.viral_score || 0)}/10<br>
                            🛡️ Safety: ${(video.analysis?.brand_safety_score || 0).toFixed(1)}/10<br>
                            🎯 ${video.analysis?.content_category || 'General'}
                        </div>
                        
                        ${video.analysis?.ai_insights ? `
                            <div style="font-size: 11px; color: #666; margin-top: 10px;">
                                <strong>AI Sentiment:</strong> ${video.analysis.ai_insights.content_tone || 'neutral'}<br>
                                <strong>Key Themes:</strong> ${(video.analysis.ai_insights.key_themes || []).join(', ') || 'None'}
                            </div>
                        ` : ''}
                        
                        <div class="recommendation-box" style="font-size: 11px; margin-top: 10px;">
                            ${video.analysis?.recommended_action || 'Monitor performance and engagement trends'}
                        </div>
                        
                        <a href="${video.url || '#'}" target="_blank" class="action-btn" style="display: block; text-align: center; margin-top: 10px; text-decoration: none; font-size: 12px; padding: 8px;">
                            ▶️ ${demoMode ? 'Demo Video' : 'Watch Video'}
                        </a>
                    </div>
                `;
            });
            
            html += '</div></div>';
            container.innerHTML = html;
        }

        function displayComparisonResults(data) {
            const { individual_results, comparison_report } = data;
            
            displayComparisonReport(comparison_report);
            displayCreatorComparison(individual_results);
            
            showResults();
        }

        function displayMultiChannelResults(data) {
            displayComparisonResults(data);
        }

        function displayComparisonReport(report) {
            const container = document.getElementById('aiInsights');
            
            const insights = `
                <div class="insight-card">
                    <div class="insight-title">🎯 Cross-Creator Analysis</div>
                    <div class="highlight-box">
                        Analyzed ${report.analyzed_channels_count || 0} creators<br>
                        Platform Average Engagement: ${report.performance_benchmarks?.avg_engagement_rate || 0}%
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">🔥 Trending Topics Across Creators</div>
                    <div class="tags-container">
                        ${Object.entries(report.trending_topics_across_creators || {}).slice(0, 5).map(([topic, count]) => 
                            `<div class="trend-indicator trend-rising">${topic} (${count})</div>`
                        ).join('') || '<p>No trending topics identified</p>'}
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">⭐ Performance Leaders</div>
                    <p><strong>High Performers:</strong> ${(report.performance_benchmarks?.high_performers || []).join(', ') || 'None identified'}</p>
                    <p><strong>Rising Creators:</strong> ${(report.performance_benchmarks?.rising_creators || []).join(', ') || 'None identified'}</p>
                </div>

                <div class="insight-card">
                    <div class="insight-title">🛡️ Brand Safety Overview</div>
                    <p><strong>Brand-Safe Creators:</strong> ${(report.brand_safety_overview?.safe_creators || []).join(', ') || 'None'}</p>
                    <p><strong>Moderate Risk:</strong> ${(report.brand_safety_overview?.moderate_risk || []).join(', ') || 'None'}</p>
                    <p><strong>High Risk:</strong> ${(report.brand_safety_overview?.high_risk || []).join(', ') || 'None'}</p>
                </div>

                <div class="insight-car>